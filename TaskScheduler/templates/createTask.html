{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4.1.3-dist/css/bootstrap.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/jquery-ui.css' %}">
<script defer src="{% static 'fontawesome/js/fontawesome-all.min.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'bootstrap-4.1.3-dist/js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/jquery-ui.js' %}"></script>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Task Scheduler</a>
		</div>
		<ul class="nav navbar-nav">
			<li class="nav-item active">
				<a class="nav-link" href="/taskscheduler/createtask">Create Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/tasklist">View Tasks</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/schedule">Schedule</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createblocked">Create Permanent Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/blockedlist">View Permanent Tasks</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createweeklyschedule">Create Weekly Schedule</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/weeklyschedulelist">View Weekly Schedule</a>
			</li>
		</ul>
	</div>
</nav>

<style type="text/css">
	.show {
		color: red;
		display: block;
		margin-left: 2%;
	}
	.hide {
		display: none;
		margin-left: 2%;
	}
</style>

<div id="errorDiv" class="hide"></div>
<form id="taskForm" class="form-horizontal" method="post" novalidate style="margin-left: 2%; margin-top: 2%;">
	{% csrf_token %}
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_name">Task Name:</label>
		<div class="col-sm-4">
			<input type="text" class="form-control" name="name" id="id_name" placeholder="Enter Task Name">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_priority">Priority:</label>
		<div class="col-sm-4">
			<input type="number" class="form-control" name="priority" id="id_priority" placeholder="Enter Task Priority">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_span">Span(in minutes):</label>
		<div class="col-sm-4">
			<input type="number" class="form-control" name="span" id="id_span" placeholder="Enter Task Span">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_deadline_date">Deadline:</label>
		<div class="col-sm-2">
			<input type="text" class="form-control" name="deadline_date" id="id_deadline_date">
		</div>
		<div class="col-sm-2">
			<input type="time" class="form-control" name="deadline_time" id="id_deadline_time">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_at_a_stretch">At a Stretch(minutes):</label>
		<div class="col-sm-4"> 
			<input type="number" class="form-control" name="at_a_stretch" id="id_at_a_stretch" placeholder="Enter At a Stretch for Task">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_max_repeats_per_day">Repeats per Day:</label>
		<div class="col-sm-4">
			<input type="number" class="form-control" name="max_repeats_per_day" id="id_max_repeats_per_day" placeholder="Enter Repeats per Day">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_break_needed_afterwards">Break Needed Afterwards(minutes):</label>
		<div class="col-sm-4">
			<input type="number" class="form-control" name="break_needed_afterwards" id="id_break_needed_afterwards" placeholder="Enter Break Time Needed After 1 Round Task Completion">
		</div>
	</div>
	<div class="form-group row"> 
		<div class="col-sm-offset-2 col-sm-10">
			<button type="submit" class="btn btn-default">Submit</button>
		</div>
	</div>
</form>

{% block javascript %}
<script type="text/javascript">
	$(function() {
		function getCookie(name) {
			var cookieValue = null;
				if (document.cookie && document.cookie != '') {
				var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) == (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		$("#id_deadline_date").datepicker();
		$("#id_deadline_date").datepicker("option", "showAnim", "slideDown");
		$('#taskForm').submit(function(e) {
			e.preventDefault();
			console.log("Preventing form submit.");
			let data = {};
			data["name"] = $("#id_name").val();
			if (data["name"] == "" || data["name"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Name should not be blank</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["priority"] = $("#id_priority").val();
			if (isNaN(data["priority"]) || data["priority"] == "" || data["priority"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Priority should be a number</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["span"] = $("#id_span").val();
			if (isNaN(data["span"]) || data["span"] == "" || data["span"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Span should be a number</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["deadline_date"] = $("#id_deadline_date").val();
			if (data["deadline_date"] == "" || data["deadline_date"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Select a valid Deadline Date</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["deadline_time"] = $("#id_deadline_time").val();
			if (data["deadline_time"] == "" || data["deadline_time"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Select a valid Deadline Time</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			if (new Date() >= new Date(data["deadline_date"].concat(" ", data["deadline_time"]))) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Select a date-time in the future!</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["at_a_stretch"] = $("#id_at_a_stretch").val();
			if (isNaN(data["at_a_stretch"]) || data["at_a_stretch"] == "" || data["at_a_stretch"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*At a stretch should be a number</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["max_repeats_per_day"] = $("#id_max_repeats_per_day").val();
			if (isNaN(data["max_repeats_per_day"]) || data["max_repeats_per_day"] == "" || data["max_repeats_per_day"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Max repeats per day should be a number</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			data["break_needed_afterwards"] = $("#id_break_needed_afterwards").val();
			if (isNaN(data["break_needed_afterwards"]) || data["break_needed_afterwards"] == "" || data["break_needed_afterwards"] == null) {
				$("#errorDiv").removeClass("hide");
				$("#errorDiv").html("<b>*Break needded afterwards should be a number</b>");
				$("#errorDiv").addClass("show");
				return;
			}
			console.log("Data for creating task: ", data);
			/*$.ajax({
				url: 'http://localhost:8000/tasksheduler/taskscheduler/createtask',
				contentType: "application/x-www-form-urlencoded",
				type: "POST",
				headers: {
					"X-CSRFToken": getCookie('csrftoken')
				},
				data: data,
				dataType: 'json',
				success: function (data) {
					console.log("Task added successfully.");
					location.reload();
				}
			});*/
		});
	});
</script>
{% endblock %}
