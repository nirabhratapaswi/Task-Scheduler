{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4.1.3-dist/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'css/bootstrap-glyphicons.css' %}">
<script defer src="{% static 'fontawesome/js/fontawesome-all.min.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'bootstrap-4.1.3-dist/js/bootstrap.min.js' %}"></script>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Task Scheduler</a>
		</div>
		<ul class="nav navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createtask">Create Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/tasklist">View Tasks</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/schedule">Schedule</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createblocked">Create Permanent Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/blockedlist">View Permanent Tasks</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createweeklyschedule">Create Weekly Schedule</a>
			</li>
			<li class="nav-item active">
				<a class="nav-link" href="/taskscheduler/weeklyschedulelist">View Weekly Schedule</a>
			</li>
		</ul>
	</div>
</nav>

<table class="table table-striped">
	<thead>
		<tr>
			<td>Task Name</td>
			<td>Start Time</td>
			<td>End Time</td>
			<td>Minimum Time to Devote</td>
			<td>Hard Bound</td>
			<td>Delete</td>
		</tr>
	</thead>
	<tbody>
		{% for w in weekly_schedule %}
			<tr>
				<td>{{ w.name }}</td>
				<td>{{ w.start_time }}</td>
				<td>{{ w.end_time }}</td>
				<td>{{ w.minimum_time_to_devote }}</td>
				{% if w.hard_bound == 1 %}
					<td>Yes</td>
				{% else %}
					<td>No</td>
				{% endif %}
				<td><a id="{{w.id}}" class="deleteBtn" href="#" style="color: red;"><span class="glyphicon glyphicon-remove"></span></a></td>
			</tr>
		{% endfor %}
	</tbody>
</table>

<!-- {% for w in weekly_schedule %}
	<h3>{{ w.name }}</h3>
	<ul>
		<li>id: {{ w.id }}</li>
		<li>Start Time: {{ w.start_time }}</li>
		<li>End Time: {{ w.end_time }}</li>
	</ul>
	<button  id="{{w.id}}" class="deleteBtn">Delete</button><br>
{% endfor %} -->

{% block javascript %}
  	<script>
		function getCookie(name) {
			var cookieValue = null;
				if (document.cookie && document.cookie != '') {
				var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) == (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
  		$(document).on("click",".deleteBtn", function () {
		    let id = $(this).attr('id');
		    $.ajax({
		        url: 'http://localhost:8000/tasksheduler/taskscheduler/deleteweeklyschedule',
		        contentType: "application/x-www-form-urlencoded",
		        type: "POST",
		        headers: {
		        	"X-CSRFToken": getCookie('csrftoken')
		        },
		        data: {
		          "id": id
		        },
		        dataType: 'json',
		        success: function (data) {
		          console.log("Weekly Schedule deleted successfully.");
		          location.reload();
		        }
		      });
		});
	</script>
{% endblock %}
