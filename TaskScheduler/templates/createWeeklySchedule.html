{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4.1.3-dist/css/bootstrap.min.css' %}">
<script defer src="{% static 'fontawesome/js/fontawesome-all.min.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'bootstrap-4.1.3-dist/js/bootstrap.min.js' %}"></script>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Task Scheduler</a>
		</div>
		<ul class="nav navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createtask">Create Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/tasklist">View Tasks</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/schedule">Schedule</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/createblocked">Create Permanent Task</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/blockedlist">View Permanent Tasks</a>
			</li>
			<li class="nav-item active">
				<a class="nav-link" href="/taskscheduler/createweeklyschedule">Create Weekly Schedule</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/taskscheduler/weeklyschedulelist">View Weekly Schedule</a>
			</li>
		</ul>
	</div>
</nav>

<style type="text/css">
	.show {
		color: red;
		display: block;
		margin-left: 2%;
	}
	.hide {
		display: none;
		margin-left: 2%;
	}
</style>

<div id="errorDiv" class="hide"></div>
<form id="weeklyScheduleForm" class="form-horizontal" method="post" novalidate style="margin-left: 2%; margin-top: 2%;">
	{% csrf_token %}
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_name">Weekly Schedule Name:</label>
		<div class="col-sm-4">
			<input type="text" class="form-control" name="name" id="id_name" placeholder="Enter Weekly Schedule Name">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_start_time">Start Time:</label>
		<div class="col-sm-4">
			<input type="time" class="form-control" name="start_time" id="id_start_time" placeholder="Enter Start Time">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_end_time">End Time:</label>
		<div class="col-sm-4">
			<input type="time" class="form-control" name="end_time" id="id_end_time" placeholder="Enter End Time">
		</div>
	</div>
	<div class="form-group row">
		<label class="control-label col-sm-2" for="id_minimum_time_to_devote">Minimum Time to Devote(minutes):</label>
		<div class="col-sm-4">
			<input type="number" class="form-control" name="minimum_time_to_devote" id="id_minimum_time_to_devote" placeholder="Enter Minimum Time to Devote">
		</div>
	</div>
	<div class="form-group row">
		<div class="checkbox">
			<input type="checkbox" name="hard_bound" id="id_hard_bound" value="1">
			<label for="id_hard_bound">Hard Bounded Task</label>
		</div>
	</div>
	<div class="form-group row">
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="0" />
			<label for="daysrepeated">Monday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="1" />
			<label for="id_start_time">Tuesday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="2" />
			<label for="id_start_time">Wednesday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="3" />
			<label for="id_start_time">Thursday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="4" />
			<label for="id_start_time">Friday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="5" />
			<label for="id_start_time">Saturday</label>
		</div>
		<div class="checkbox">
			<input type="checkbox" name="daysrepeated" value="6" />
			<label for="id_start_time">Sunday</label>
		</div>
	</div>
	<div class="form-group row"> 
		<div class="col-sm-offset-2 col-sm-10">
			<button type="submit" class="btn btn-default">Submit</button>
		</div>
	</div>
</form>

{% block javascript %}
	<script>
		function getCookie(name) {
			var cookieValue = null;
				if (document.cookie && document.cookie != '') {
				var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) == (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		$(function() {
			$('#weeklyScheduleForm').submit(function(e) {
				e.preventDefault();
				console.log("Preventing form submit.");
				let data = {};
				data["days_repeated"] = $("input[name=daysrepeated]:checked").map(function() {
					return this.value;
				})
				.get()
				.join();
				data["name"] = $("#id_name").val();
				if (data["name"] == "" || data["name"] == null) {
					$("#errorDiv").removeClass("hide");
					$("#errorDiv").html("<b>*Name should not be blank</b>");
					$("#errorDiv").addClass("show");
					return;
				}
				data["start_time"] = $("#id_start_time").val();
				if (data["start_time"] == "" || data["start_time"] == null) {
					$("#errorDiv").removeClass("hide");
					$("#errorDiv").html("<b>*Start Time should not be blank</b>");
					$("#errorDiv").addClass("show");
					return;
				}
				data["end_time"] = $("#id_end_time").val();
				if (data["end_time"] == "" || data["end_time"] == null) {
					$("#errorDiv").removeClass("hide");
					$("#errorDiv").html("<b>*End Time should not be blank</b>");
					$("#errorDiv").addClass("show");
					return;
				}
				data["minimum_time_to_devote"] = $("#id_minimum_time_to_devote").val() | 0;
				if (isNaN(data["minimum_time_to_devote"]) || data["minimum_time_to_devote"] == "" || data["minimum_time_to_devote"] == null) {
					$("#errorDiv").removeClass("hide");
					$("#errorDiv").html("<b>*Minimum time to devote should be a number.</b>");
					$("#errorDiv").addClass("show");
					return;
				}
				data["hard_bound"] = $("#id_hard_bound").val();
				if (isNaN(data["hard_bound"]) || data["hard_bound"] == "" || data["hard_bound"] == null) {
					$("#errorDiv").removeClass("hide");
					$("#errorDiv").html("<b>*Hard bound should not be blank</b>");
					$("#errorDiv").addClass("show");
					return;
				}
				console.log("Data: ", data);
				$.ajax({
					url: 'http://localhost:8000/tasksheduler/taskscheduler/createweeklyschedule',
					contentType: "application/x-www-form-urlencoded",
					type: "POST",
					headers: {
						"X-CSRFToken": getCookie('csrftoken')
					},
					data: data,
					dataType: 'json',
					success: function (data) {
						console.log("Weekly Schedule added successfully.");
						location.reload();
					}
				});
			});
			$("#id_hard_bound").change(function(e) {
				if ($("#id_hard_bound").prop('checked') == true) {
					$("#id_minimum_time_to_devote").attr("disabled", true);
				} else {
					$("#id_minimum_time_to_devote").attr("disabled", false);
				}
			});
			$("#id_minimum_time_to_devote").attr("disabled", true);
			$("#id_hard_bound").attr("checked", true);
		});
	</script>
{% endblock %}
